{
    "properties": {
      "displayName": "Ensure Subscriptions send Activity Logs to Log Analytics",
      "policyType": "Custom",
      "mode": "All",
      "description": "Ensure Subscriptions send Activity Logs to Log Analytics",
      "metadata": {
        "Version": "20230524-1",
        "createdBy": "dee8ccdd-b4d5-4c1c-b255-9a22c65004e9",
        "createdOn": "2023-04-27T22:33:34.3788159Z",
        "updatedBy": "dee8ccdd-b4d5-4c1c-b255-9a22c65004e9",
        "updatedOn": "2023-05-25T05:48:16.1699882Z"
      },
      "parameters": {},
      "policyRule": {
        "if": {
          "field": "type",
          "equals": "Microsoft.Resources/subscriptions"
        },
        "then": {
          "effect": "AuditIfNotExists",
          "details": {
            "roleDefinitionIds": [
              "/providers/Microsoft.Authorization/roleDefinitions/92aaf0da-9dab-42b6-94a3-d43ce8d16293"
            ],
            "type": "Microsoft.Insights/diagnosticSettings",
            "name": "MCAPSGov-LogsToLAWS",
            "existenceScope": "Subscription",
            "existenceCondition": {
              "allOf": [
                {
                  "count": {
                    "field": "Microsoft.Insights/diagnosticSettings/logs[*]",
                    "where": {
                      "allOf": [
                        {
                          "field": "Microsoft.Insights/diagnosticSettings/logs[*].category",
                          "equals": "Administrative"
                        },
                        {
                          "field": "Microsoft.Insights/diagnosticSettings/logs[*].enabled",
                          "equals": "true"
                        }
                      ]
                    }
                  },
                  "greater": 0
                },
                {
                  "count": {
                    "field": "Microsoft.Insights/diagnosticSettings/logs[*]",
                    "where": {
                      "allOf": [
                        {
                          "field": "Microsoft.Insights/diagnosticSettings/logs[*].category",
                          "equals": "Security"
                        },
                        {
                          "field": "Microsoft.Insights/diagnosticSettings/logs[*].enabled",
                          "equals": "true"
                        }
                      ]
                    }
                  },
                  "greater": 0
                },
                {
                  "field": "Microsoft.Insights/diagnosticSettings/workspaceId",
                  "equals": "/subscriptions/6b76ff87-a921-49fe-a04a-92aebd1ac6fa/resourceGroups/MCAPSGov-corp-RG/providers/Microsoft.OperationalInsights/workspaces/MCAPSGov-corp-ActivityLogsWorkspace"
                }
              ]
            }
          }
        }
      }
    },
    "id": "/providers/Microsoft.Management/managementGroups/D6AF5F85-2A50-4370-B4B5-9B9A55BCB0DC/providers/Microsoft.Authorization/policyDefinitions/Subscription_ActivityLogsToLAWS",
    "type": "Microsoft.Authorization/policyDefinitions",
    "name": "Subscription_ActivityLogsToLAWS",
    "systemData": {
      "createdBy": "eadea216-1d5c-4a4b-beaf-4f145e6b1cb4",
      "createdByType": "Application",
      "createdAt": "2023-04-27T22:33:34.3527145Z",
      "lastModifiedBy": "eadea216-1d5c-4a4b-beaf-4f145e6b1cb4",
      "lastModifiedByType": "Application",
      "lastModifiedAt": "2023-05-25T05:48:16.1360094Z"
    }
  }